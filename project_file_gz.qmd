---
title: "Project_File_Z_G"
format: html
editor: visual
---

```{r}
#| include: FALSE
library(tidyverse)
library(stringr)
library(rvest)
library(polite)
library(sf)
library(maps)
library(viridis)
library(leaflet)
library(htmltools)
library(httr)
library(httr2)
library(janitor)
```

Penguin Random House Web Scraping

```{r}
robotstxt::paths_allowed("https://www.penguinrandomhouse.com/authors/events/")

info_from_page <- function(event, css_selector) {
  read_html(event) |> 
    html_nodes(css_selector) |> 
    html_text()
}

info_from_page("https://www.penguinrandomhouse.com/authors/events/", ".date-display")
```

```{r}
scrape_events <- function(url) {
    Sys.sleep(2)
    event_date <- info_from_page(url, ".start")
    event_book <- info_from_page(url, ".author-of a")
    event_author <- info_from_page(url, ".author-name:nth-child(1)")
    event_host <- info_from_page(url, ".event-location .hdr")
    event_state <- info_from_page(url, "span:nth-child(4)")
    
    tibble(date = event_date, 
           book = event_book, 
           author = event_author,
           host = event_host,
           state = event_state
    )
}
```

```{r}
scrape_events("https://www.penguinrandomhouse.com/authors/events/?page=2")
```
```{r}
event_day <- function(date_from, date_to){
  base_url <- "https://www.penguinrandomhouse.com/authors/events/?"
  penguin_url <- str_c(base_url, "datefrom=", date_from , "&dateto=", date_to)
  
  date <- info_from_page(penguin_url, ".start")
  book <- info_from_page(penguin_url, ".author-of a")
  author <- info_from_page(penguin_url, ".author-name:nth-child(1)")
  host <- info_from_page(penguin_url, ".event-location .hdr")
  state <- info_from_page(penguin_url, "span:nth-child(4)")
  
  tibble(date = date, 
           book = book, 
           author = author,
           host = host,
           state = state)
  
}

event_day("11/01/2024", "11/01/2024")
```

```{r}
for(i in c(10, 11, 12, 1, 2, 3, 4)){
  for(j in 1:31){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    scrape_events(url)
  }
}
```
```{r}
i=11
j=1
date = str_c(i, "/", j, "/", "2024")
url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
scrape_events(url)
```

```{r}
october <- list()
  i=10
for(j in 23:31){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    october[[j]] <- scrape_events(url)
}
  
  october_tibble <- bind_rows(october) |> 
  as.tibble()
```

```{r}
november <- list()
  i=11
for(j in 1:20){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    november[[j]] <- scrape_events(url)
}
  
  november_tibble <- bind_rows(november) |> 
    as.tibble()
```

```{r}
december <- list()
  i=12
for(j in 1:31){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    december[[j]] <- scrape_events(url)
}
  
  december_tibble <- bind_rows(december) |> 
    as.tibble()
```

```{r}
january <- list()
  i=1
for(j in 1:31){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    january[[j]] <- scrape_events(url)
}
  
  bind_rows(january)
```

```{r}
february <- list()
  i=2
for(j in 1:28){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    february[[j]] <- scrape_events(url)
}
  
  bind_rows(february)
```

```{r}
march <- list()
  i=3
for(j in 1:31){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    march[[j]] <- scrape_events(url)
}
  
  bind_rows(march)
```

```{r}
april <- list()
  i=4
for(j in 1:30){
    date = str_c(i, "/", j, "/", "2024")
    url = str_c("https://www.penguinrandomhouse.com/authors/events/?datefrom=", date, "&dateto=", date)
    april[[j]] <- scrape_events(url)
}
  
  bind_rows(april)
```

